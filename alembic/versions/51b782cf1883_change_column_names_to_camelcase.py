"""Change column names to camelCase

Revision ID: 51b782cf1883
Revises: 947b7042e023
Create Date: 2025-11-09 00:50:00.938122

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = '51b782cf1883'
down_revision: Union[str, None] = '947b7042e023'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('cards', sa.Column('qrCode', sa.String(length=255), nullable=False, comment='QR 코드 값'))
    op.add_column('cards', sa.Column('activityType', sa.String(length=100), nullable=False, comment='활동 유형 (season_select, drawing, quiz 등)'))
    op.add_column('cards', sa.Column('activityData', postgresql.JSONB(astext_type=sa.Text()), nullable=False, comment='활동 옵션/설정 JSON'))
    op.add_column('cards', sa.Column('thumbnailUrl', sa.Text(), nullable=True, comment='카드 썸네일 이미지 URL'))
    op.add_column('cards', sa.Column('isActive', sa.Boolean(), server_default='true', nullable=False, comment='활성화 여부'))
    op.add_column('cards', sa.Column('createdAt', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False, comment='생성 시각'))
    op.add_column('cards', sa.Column('updatedAt', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False, comment='수정 시각'))
    op.drop_constraint('cards_qr_code_key', 'cards', type_='unique')
    op.drop_index('ix_cards_activity_type', table_name='cards')
    op.drop_index('ix_cards_is_active', table_name='cards')
    op.drop_index('ix_cards_qr_code', table_name='cards')
    op.create_index('ix_cards_activityType', 'cards', ['activityType'], unique=False)
    op.create_index('ix_cards_isActive', 'cards', ['isActive'], unique=False)
    op.create_index('ix_cards_qrCode', 'cards', ['qrCode'], unique=True)
    op.create_unique_constraint(None, 'cards', ['qrCode'])
    op.drop_column('cards', 'updated_at')
    op.drop_column('cards', 'thumbnail_url')
    op.drop_column('cards', 'activity_data')
    op.drop_column('cards', 'created_at')
    op.drop_column('cards', 'qr_code')
    op.drop_column('cards', 'is_active')
    op.drop_column('cards', 'activity_type')
    op.add_column('shares', sa.Column('userId', sa.UUID(), nullable=False, comment='공유 생성자'))
    op.add_column('shares', sa.Column('cardId', sa.UUID(), nullable=False, comment='공유할 카드'))
    op.add_column('shares', sa.Column('shareToken', sa.String(length=255), nullable=False, comment='공유 토큰 (자동 생성)'))
    op.add_column('shares', sa.Column('expiryDate', sa.DateTime(timezone=True), nullable=True, comment='만료일 (선택)'))
    op.add_column('shares', sa.Column('viewCount', sa.Integer(), server_default='0', nullable=False, comment='조회수'))
    op.add_column('shares', sa.Column('isActive', sa.Boolean(), server_default='true', nullable=False, comment='활성화 여부'))
    op.add_column('shares', sa.Column('createdAt', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False, comment='생성 시각'))
    op.add_column('shares', sa.Column('updatedAt', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False, comment='수정 시각'))
    op.drop_index('ix_shares_card_id', table_name='shares')
    op.drop_index('ix_shares_share_token', table_name='shares')
    op.drop_index('ix_shares_user_id', table_name='shares')
    op.drop_constraint('shares_share_token_key', 'shares', type_='unique')
    op.drop_index('ix_shares_active_expiry', table_name='shares')
    op.create_index('ix_shares_active_expiry', 'shares', ['isActive', 'expiryDate'], unique=False)
    op.drop_index('ix_shares_user_active', table_name='shares')
    op.create_index('ix_shares_user_active', 'shares', ['userId', 'isActive'], unique=False)
    op.create_index('ix_shares_cardId', 'shares', ['cardId'], unique=False)
    op.create_index('ix_shares_shareToken', 'shares', ['shareToken'], unique=True)
    op.create_index('ix_shares_userId', 'shares', ['userId'], unique=False)
    op.create_unique_constraint(None, 'shares', ['shareToken'])
    op.drop_constraint('shares_card_id_fkey', 'shares', type_='foreignkey')
    op.drop_constraint('shares_user_id_fkey', 'shares', type_='foreignkey')
    op.create_foreign_key(None, 'shares', 'cards', ['cardId'], ['id'], onupdate='CASCADE', ondelete='CASCADE')
    op.create_foreign_key(None, 'shares', 'users', ['userId'], ['id'], onupdate='CASCADE', ondelete='CASCADE')
    op.drop_column('shares', 'updated_at')
    op.drop_column('shares', 'view_count')
    op.drop_column('shares', 'share_token')
    op.drop_column('shares', 'card_id')
    op.drop_column('shares', 'created_at')
    op.drop_column('shares', 'user_id')
    op.drop_column('shares', 'expiry_date')
    op.drop_column('shares', 'is_active')
    op.add_column('user_card_activities', sa.Column('userId', sa.UUID(), nullable=False, comment='활동 수행 사용자'))
    op.add_column('user_card_activities', sa.Column('cardId', sa.UUID(), nullable=False, comment='활동한 카드'))
    op.add_column('user_card_activities', sa.Column('activityResult', postgresql.JSONB(astext_type=sa.Text()), nullable=False, comment='사용자 활동 결과 JSON'))
    op.add_column('user_card_activities', sa.Column('completedAt', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False, comment='활동 완료 시각'))
    op.add_column('user_card_activities', sa.Column('createdAt', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False, comment='기록 생성 시각'))
    op.drop_index('ix_user_card_activities_card_id', table_name='user_card_activities')
    op.drop_index('ix_user_card_activities_completed_at', table_name='user_card_activities')
    op.drop_index('ix_user_card_activities_user_id', table_name='user_card_activities')
    op.drop_index('ix_user_card_activities_user_card', table_name='user_card_activities')
    op.create_index('ix_user_card_activities_user_card', 'user_card_activities', ['userId', 'cardId'], unique=False)
    op.drop_index('ix_user_card_activities_user_completed', table_name='user_card_activities')
    op.create_index('ix_user_card_activities_user_completed', 'user_card_activities', ['userId', 'completedAt'], unique=False)
    op.create_index('ix_user_card_activities_cardId', 'user_card_activities', ['cardId'], unique=False)
    op.create_index('ix_user_card_activities_completedAt', 'user_card_activities', ['completedAt'], unique=False)
    op.create_index('ix_user_card_activities_userId', 'user_card_activities', ['userId'], unique=False)
    op.drop_constraint('user_card_activities_card_id_fkey', 'user_card_activities', type_='foreignkey')
    op.drop_constraint('user_card_activities_user_id_fkey', 'user_card_activities', type_='foreignkey')
    op.create_foreign_key(None, 'user_card_activities', 'users', ['userId'], ['id'], onupdate='CASCADE', ondelete='CASCADE')
    op.create_foreign_key(None, 'user_card_activities', 'cards', ['cardId'], ['id'], onupdate='CASCADE', ondelete='CASCADE')
    op.drop_column('user_card_activities', 'completed_at')
    op.drop_column('user_card_activities', 'card_id')
    op.drop_column('user_card_activities', 'created_at')
    op.drop_column('user_card_activities', 'user_id')
    op.drop_column('user_card_activities', 'activity_result')
    op.add_column('users', sa.Column('userId', sa.String(length=255), nullable=False, comment='로그인 id'))
    op.add_column('users', sa.Column('userName', sa.String(length=100), nullable=False, comment='사용자 이름'))
    op.add_column('users', sa.Column('phoneNumber', sa.String(length=20), nullable=True, comment='전화번호'))
    op.add_column('users', sa.Column('profileImageUrl', sa.String(), nullable=True, comment='프로필 이미지 URL'))
    op.add_column('users', sa.Column('socialProvider', sa.Enum('KAKAO', name='social_provider_type'), nullable=True, comment='소셜 로그인 제공자'))
    op.add_column('users', sa.Column('socialId', sa.String(length=255), nullable=True, comment='소셜 로그인 ID'))
    op.add_column('users', sa.Column('isActive', sa.Boolean(), server_default='true', nullable=False, comment='계정 활성화 여부'))
    op.add_column('users', sa.Column('lastLoginAt', sa.DateTime(timezone=True), nullable=True, comment='마지막 로그인 시각'))
    op.add_column('users', sa.Column('createdAt', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False, comment='생성 시각'))
    op.add_column('users', sa.Column('updatedAt', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False, comment='수정 시각'))
    op.drop_index('ix_users_email', table_name='users')
    op.drop_constraint('users_email_key', 'users', type_='unique')
    op.drop_index('ix_users_social_login', table_name='users', postgresql_where='(social_provider IS NOT NULL)')
    op.create_index('ix_users_social_login', 'users', ['socialProvider', 'socialId'], unique=True, postgresql_where=sa.text('"socialProvider" IS NOT NULL'))
    op.create_index('ix_users_userId', 'users', ['userId'], unique=True)
    op.create_unique_constraint(None, 'users', ['userId'])
    op.drop_column('users', 'username')
    op.drop_column('users', 'updated_at')
    op.drop_column('users', 'last_login_at')
    op.drop_column('users', 'social_provider')
    op.drop_column('users', 'email')
    op.drop_column('users', 'social_id')
    op.drop_column('users', 'profile_image_url')
    op.drop_column('users', 'created_at')
    op.drop_column('users', 'phone_number')
    op.drop_column('users', 'is_active')
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('users', sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False, comment='계정 활성화 여부'))
    op.add_column('users', sa.Column('phone_number', sa.VARCHAR(length=20), autoincrement=False, nullable=True, comment='전화번호'))
    op.add_column('users', sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False, comment='생성 시각'))
    op.add_column('users', sa.Column('profile_image_url', sa.VARCHAR(), autoincrement=False, nullable=True, comment='프로필 이미지 URL'))
    op.add_column('users', sa.Column('social_id', sa.VARCHAR(length=255), autoincrement=False, nullable=True, comment='소셜 로그인 ID'))
    op.add_column('users', sa.Column('email', sa.VARCHAR(length=255), autoincrement=False, nullable=False, comment='이메일 (로그인 ID)'))
    op.add_column('users', sa.Column('social_provider', postgresql.ENUM('KAKAO', name='social_provider_type'), autoincrement=False, nullable=True, comment='소셜 로그인 제공자'))
    op.add_column('users', sa.Column('last_login_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True, comment='마지막 로그인 시각'))
    op.add_column('users', sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False, comment='수정 시각'))
    op.add_column('users', sa.Column('username', sa.VARCHAR(length=100), autoincrement=False, nullable=False, comment='사용자 이름'))
    op.drop_constraint(None, 'users', type_='unique')
    op.drop_index('ix_users_userId', table_name='users')
    op.drop_index('ix_users_social_login', table_name='users', postgresql_where=sa.text('"socialProvider" IS NOT NULL'))
    op.create_index('ix_users_social_login', 'users', ['social_provider', 'social_id'], unique=True, postgresql_where='(social_provider IS NOT NULL)')
    op.create_unique_constraint('users_email_key', 'users', ['email'])
    op.create_index('ix_users_email', 'users', ['email'], unique=True)
    op.drop_column('users', 'updatedAt')
    op.drop_column('users', 'createdAt')
    op.drop_column('users', 'lastLoginAt')
    op.drop_column('users', 'isActive')
    op.drop_column('users', 'socialId')
    op.drop_column('users', 'socialProvider')
    op.drop_column('users', 'profileImageUrl')
    op.drop_column('users', 'phoneNumber')
    op.drop_column('users', 'userName')
    op.drop_column('users', 'userId')
    op.add_column('user_card_activities', sa.Column('activity_result', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=False, comment='사용자 활동 결과 JSON'))
    op.add_column('user_card_activities', sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False, comment='활동 수행 사용자'))
    op.add_column('user_card_activities', sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False, comment='기록 생성 시각'))
    op.add_column('user_card_activities', sa.Column('card_id', sa.UUID(), autoincrement=False, nullable=False, comment='활동한 카드'))
    op.add_column('user_card_activities', sa.Column('completed_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False, comment='활동 완료 시각'))
    op.drop_constraint(None, 'user_card_activities', type_='foreignkey')
    op.drop_constraint(None, 'user_card_activities', type_='foreignkey')
    op.create_foreign_key('user_card_activities_user_id_fkey', 'user_card_activities', 'users', ['user_id'], ['id'], onupdate='CASCADE', ondelete='CASCADE')
    op.create_foreign_key('user_card_activities_card_id_fkey', 'user_card_activities', 'cards', ['card_id'], ['id'], onupdate='CASCADE', ondelete='CASCADE')
    op.drop_index('ix_user_card_activities_userId', table_name='user_card_activities')
    op.drop_index('ix_user_card_activities_completedAt', table_name='user_card_activities')
    op.drop_index('ix_user_card_activities_cardId', table_name='user_card_activities')
    op.drop_index('ix_user_card_activities_user_completed', table_name='user_card_activities')
    op.create_index('ix_user_card_activities_user_completed', 'user_card_activities', ['user_id', 'completed_at'], unique=False)
    op.drop_index('ix_user_card_activities_user_card', table_name='user_card_activities')
    op.create_index('ix_user_card_activities_user_card', 'user_card_activities', ['user_id', 'card_id'], unique=False)
    op.create_index('ix_user_card_activities_user_id', 'user_card_activities', ['user_id'], unique=False)
    op.create_index('ix_user_card_activities_completed_at', 'user_card_activities', ['completed_at'], unique=False)
    op.create_index('ix_user_card_activities_card_id', 'user_card_activities', ['card_id'], unique=False)
    op.drop_column('user_card_activities', 'createdAt')
    op.drop_column('user_card_activities', 'completedAt')
    op.drop_column('user_card_activities', 'activityResult')
    op.drop_column('user_card_activities', 'cardId')
    op.drop_column('user_card_activities', 'userId')
    op.add_column('shares', sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False, comment='활성화 여부'))
    op.add_column('shares', sa.Column('expiry_date', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True, comment='만료일 (선택)'))
    op.add_column('shares', sa.Column('user_id', sa.UUID(), autoincrement=False, nullable=False, comment='공유 생성자'))
    op.add_column('shares', sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False, comment='생성 시각'))
    op.add_column('shares', sa.Column('card_id', sa.UUID(), autoincrement=False, nullable=False, comment='공유할 카드'))
    op.add_column('shares', sa.Column('share_token', sa.VARCHAR(length=255), autoincrement=False, nullable=False, comment='공유 토큰 (자동 생성)'))
    op.add_column('shares', sa.Column('view_count', sa.INTEGER(), server_default=sa.text('0'), autoincrement=False, nullable=False, comment='조회수'))
    op.add_column('shares', sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False, comment='수정 시각'))
    op.drop_constraint(None, 'shares', type_='foreignkey')
    op.drop_constraint(None, 'shares', type_='foreignkey')
    op.create_foreign_key('shares_user_id_fkey', 'shares', 'users', ['user_id'], ['id'], onupdate='CASCADE', ondelete='CASCADE')
    op.create_foreign_key('shares_card_id_fkey', 'shares', 'cards', ['card_id'], ['id'], onupdate='CASCADE', ondelete='CASCADE')
    op.drop_constraint(None, 'shares', type_='unique')
    op.drop_index('ix_shares_userId', table_name='shares')
    op.drop_index('ix_shares_shareToken', table_name='shares')
    op.drop_index('ix_shares_cardId', table_name='shares')
    op.drop_index('ix_shares_user_active', table_name='shares')
    op.create_index('ix_shares_user_active', 'shares', ['user_id', 'is_active'], unique=False)
    op.drop_index('ix_shares_active_expiry', table_name='shares')
    op.create_index('ix_shares_active_expiry', 'shares', ['is_active', 'expiry_date'], unique=False)
    op.create_unique_constraint('shares_share_token_key', 'shares', ['share_token'])
    op.create_index('ix_shares_user_id', 'shares', ['user_id'], unique=False)
    op.create_index('ix_shares_share_token', 'shares', ['share_token'], unique=True)
    op.create_index('ix_shares_card_id', 'shares', ['card_id'], unique=False)
    op.drop_column('shares', 'updatedAt')
    op.drop_column('shares', 'createdAt')
    op.drop_column('shares', 'isActive')
    op.drop_column('shares', 'viewCount')
    op.drop_column('shares', 'expiryDate')
    op.drop_column('shares', 'shareToken')
    op.drop_column('shares', 'cardId')
    op.drop_column('shares', 'userId')
    op.add_column('cards', sa.Column('activity_type', sa.VARCHAR(length=100), autoincrement=False, nullable=False, comment='활동 유형 (season_select, drawing, quiz 등)'))
    op.add_column('cards', sa.Column('is_active', sa.BOOLEAN(), server_default=sa.text('true'), autoincrement=False, nullable=False, comment='활성화 여부'))
    op.add_column('cards', sa.Column('qr_code', sa.VARCHAR(length=255), autoincrement=False, nullable=False, comment='QR 코드 값'))
    op.add_column('cards', sa.Column('created_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False, comment='생성 시각'))
    op.add_column('cards', sa.Column('activity_data', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=False, comment='활동 옵션/설정 JSON'))
    op.add_column('cards', sa.Column('thumbnail_url', sa.TEXT(), autoincrement=False, nullable=True, comment='카드 썸네일 이미지 URL'))
    op.add_column('cards', sa.Column('updated_at', postgresql.TIMESTAMP(timezone=True), server_default=sa.text('now()'), autoincrement=False, nullable=False, comment='수정 시각'))
    op.drop_constraint(None, 'cards', type_='unique')
    op.drop_index('ix_cards_qrCode', table_name='cards')
    op.drop_index('ix_cards_isActive', table_name='cards')
    op.drop_index('ix_cards_activityType', table_name='cards')
    op.create_index('ix_cards_qr_code', 'cards', ['qr_code'], unique=True)
    op.create_index('ix_cards_is_active', 'cards', ['is_active'], unique=False)
    op.create_index('ix_cards_activity_type', 'cards', ['activity_type'], unique=False)
    op.create_unique_constraint('cards_qr_code_key', 'cards', ['qr_code'])
    op.drop_column('cards', 'updatedAt')
    op.drop_column('cards', 'createdAt')
    op.drop_column('cards', 'isActive')
    op.drop_column('cards', 'thumbnailUrl')
    op.drop_column('cards', 'activityData')
    op.drop_column('cards', 'activityType')
    op.drop_column('cards', 'qrCode')
    # ### end Alembic commands ###
